<div class="w-full max-w-5xl mx-auto space-y-6">
  <!-- Encabezado -->
  <div class="flex flex-col sm:flex-row sm:items-end sm:justify-between gap-3">
    <div>
      <p class="text-xs font-semibold uppercase tracking-[0.25em] text-primary">
        Generar recomendación
      </p>
      <h1 class="mt-1 text-2xl sm:text-3xl font-bold">
        Registro para recomendación de lesión
      </h1>
      <p class="mt-2 text-sm text-text-muted max-w-xl">
        Completa los datos de la sesión y de tu condición actual. Los datos del jugador se toman de tu perfil
        para que el modelo de Soccer-Prev personalice la recomendación.
      </p>
    </div>

    <span class="text-[11px] text-text-muted">
      Fecha de registro: {{ today | date:'yyyy-MM-dd' }}
    </span>
  </div>

  <!-- Formulario -->
  <form class="space-y-5" (ngSubmit)="onSubmit()" #condForm="ngForm">
    <!-- DATOS DEL JUGADOR (solo lectura) -->
    <div class="bg-app-card border border-app-border rounded-2xl p-4 sm:p-5 space-y-4">
      <div class="flex items-center justify-between gap-3">
        <h2 class="text-sm font-semibold">Datos del jugador</h2>
        <p class="text-[11px] text-text-muted">
          Edita estos datos desde tu <span class="font-semibold">Perfil</span> si necesitas cambiarlos.
        </p>
      </div>

      <div class="grid sm:grid-cols-3 gap-4 text-sm">
        <!-- Edad -->
        <div class="space-y-1">
          <p class="text-xs text-text-muted">Edad (años)</p>
          <p class="font-medium text-text-main">
            {{ conditionForm.edad !== null ? conditionForm.edad + ' años' : 'Sin dato' }}
          </p>
        </div>

        <!-- Peso -->
        <div class="space-y-1">
          <p class="text-xs text-text-muted">Peso (kg)</p>
          <p class="font-medium text-text-main">
            {{ conditionForm.peso !== null ? (conditionForm.peso | number:'1.1-1') + ' kg' : 'Sin dato' }}
          </p>
        </div>

        <!-- Estatura -->
        <div class="space-y-1">
          <p class="text-xs text-text-muted">Estatura (m)</p>
          <p class="font-medium text-text-main">
            {{
              conditionForm.estatura_m !== null
                ? (conditionForm.estatura_m | number:'1.2-2') + ' m'
                : 'Sin dato'
            }}
          </p>
        </div>
      </div>

      <div class="grid sm:grid-cols-3 gap-4 text-sm">
        <!-- Posición -->
        <div class="space-y-1">
          <p class="text-xs text-text-muted">Posición principal</p>
          <p class="font-medium text-text-main">
            {{ conditionForm.posicion || 'Sin dato' }}
          </p>
        </div>

        <!-- Nivel -->
        <div class="space-y-1">
          <p class="text-xs text-text-muted">Nivel</p>
          <p class="font-medium text-text-main">
            {{
              conditionForm.nivel === 'basico'
                ? 'Básico'
                : conditionForm.nivel === 'intermedio'
                ? 'Intermedio'
                : conditionForm.nivel === 'avanzado'
                ? 'Avanzado'
                : (conditionForm.nivel || 'Sin dato')
            }}
          </p>
        </div>

        <!-- Partidos por semana -->
        <div class="space-y-1">
          <p class="text-xs text-text-muted">Partidos por semana</p>
          <p class="font-medium text-text-main">
            {{
              conditionForm.frecuencia_juego_semana !== null
                ? conditionForm.frecuencia_juego_semana
                : 'Sin dato'
            }}
          </p>
        </div>
      </div>
    </div>

    <!-- CONTEXTO DE LA SESIÓN (editable) -->
    <div class="bg-app-card border border-app-border rounded-2xl p-4 sm:p-5 space-y-4">
      <h2 class="text-sm font-semibold">Datos de la sesión</h2>

      <div class="grid sm:grid-cols-3 gap-4 text-sm">
        <!-- Duración -->
        <div class="space-y-1">
          <label class="text-xs text-text-muted">Duración de la sesión (min)</label>
          <input
            type="number"
            min="30"
            max="150"
            [(ngModel)]="conditionForm.duracion_partido_min"
            name="duracion_partido_min"
            placeholder="Ejemplo: 90"
            class="w-full rounded-lg border border-app-border bg-slate-900 px-3 py-2 text-sm outline-none
                   focus:border-primary focus:ring-2 focus:ring-primary/40"
          />
        </div>

        <!-- Superficie -->
        <div class="space-y-1">
          <label class="text-xs text-text-muted">Superficie</label>
          <select
            [(ngModel)]="conditionForm.superficie"
            name="superficie"
            class="w-full rounded-lg border border-app-border bg-slate-900 px-3 py-2 text-sm outline-none
                   focus:border-primary focus:ring-2 focus:ring-primary/40"
          >
            <option value="" disabled>Selecciona la superficie</option>
            <option value="pasto">Pasto natural</option>
            <option value="sintetico">Sintético</option>
            <option value="tierra">Tierra / mixta</option>
          </select>
        </div>

        <!-- Clima -->
        <div class="space-y-1">
          <label class="text-xs text-text-muted">Clima</label>
          <select
            [(ngModel)]="conditionForm.clima"
            name="clima"
            class="w-full rounded-lg border border-app-border bg-slate-900 px-3 py-2 text-sm outline-none
                   focus:border-primary focus:ring-2 focus:ring-primary/40"
          >
            <option value="" disabled>Selecciona el clima</option>
            <option value="templado">Templado</option>
            <option value="calido">Cálido</option>
            <option value="frio">Frío</option>
          </select>
        </div>
      </div>

      <div class="grid sm:grid-cols-4 gap-4 text-sm">
        <!-- Entrena -->
        <div class="space-y-1">
          <label class="text-xs text-text-muted">¿Entrenas extra esta semana?</label>
          <select
            [(ngModel)]="conditionForm.entrena"
            name="entrena"
            class="w-full rounded-lg border border-app-border bg-slate-900 px-3 py-2 text-sm outline-none
                   focus:border-primary focus:ring-2 focus:ring-primary/40"
          >
            <option [ngValue]="null" disabled>Selecciona una opción</option>
            <option [ngValue]="1">Sí</option>
            <option [ngValue]="0">No</option>
          </select>
        </div>

        <!-- Calienta -->
        <div class="space-y-1">
          <label class="text-xs text-text-muted">¿Realizaste calentamiento?</label>
          <select
            [(ngModel)]="conditionForm.calienta"
            name="calienta"
            class="w-full rounded-lg border border-app-border bg-slate-900 px-3 py-2 text-sm outline-none
                   focus:border-primary focus:ring-2 focus:ring-primary/40"
          >
            <option [ngValue]="null" disabled>Selecciona una opción</option>
            <option [ngValue]="1">Sí</option>
            <option [ngValue]="0">No</option>
          </select>
        </div>

        <!-- Minutos de calentamiento -->
        <div class="space-y-1">
          <label class="text-xs text-text-muted">Minutos de calentamiento</label>
          <input
            type="number"
            min="0"
            max="60"
            [(ngModel)]="conditionForm.calentamiento_min"
            name="calentamiento_min"
            placeholder="Ejemplo: 15"
            class="w-full rounded-lg border border-app-border bg-slate-900 px-3 py-2 text-sm outline-none
                   focus:border-primary focus:ring-2 focus:ring-primary/40"
          />
        </div>

        <!-- Horas de sueño -->
        <div class="space-y-1">
          <label class="text-xs text-text-muted">Horas de sueño (última noche)</label>
          <input
            type="number"
            min="0"
            max="12"
            step="0.5"
            [(ngModel)]="conditionForm.horas_sueno"
            name="horas_sueno"
            placeholder="Ejemplo: 7.5"
            class="w-full rounded-lg border border-app-border bg-slate-900 px-3 py-2 text-sm outline-none
                   focus:border-primary focus:ring-2 focus:ring-primary/40"
          />
        </div>
      </div>

      <div class="grid sm:grid-cols-3 gap-4 text-sm">
        <!-- Hidratación -->
        <div class="space-y-1">
          <label class="text-xs text-text-muted">Hidratación adecuada hoy</label>
          <select
            [(ngModel)]="conditionForm.hidratacion_ok"
            name="hidratacion_ok"
            class="w-full rounded-lg border border-app-border bg-slate-900 px-3 py-2 text-sm outline-none
                   focus:border-primary focus:ring-2 focus:ring-primary/40"
          >
            <option [ngValue]="null" disabled>Selecciona una opción</option>
            <option [ngValue]="1">Sí</option>
            <option [ngValue]="0">No</option>
          </select>
        </div>

        <!-- Lesiones último año -->
        <div class="space-y-1">
          <label class="text-xs text-text-muted">Lesiones en el último año</label>
          <input
            type="number"
            min="0"
            max="10"
            [(ngModel)]="conditionForm.lesiones_ultimo_anno"
            name="lesiones_ultimo_anno"
            placeholder="Ejemplo: 1"
            class="w-full rounded-lg border border-app-border bg-slate-900 px-3 py-2 text-sm outline-none
                   focus:border-primary focus:ring-2 focus:ring-primary/40"
          />
        </div>

        <!-- Recuperación -->
        <div class="space-y-1">
          <label class="text-xs text-text-muted">¿Has seguido plan de recuperación esta semana?</label>
          <select
            [(ngModel)]="conditionForm.recuperacion_sem"
            name="recuperacion_sem"
            class="w-full rounded-lg border border-app-border bg-slate-900 px-3 py-2 text-sm outline-none
                   focus:border-primary focus:ring-2 focus:ring-primary/40"
          >
            <option [ngValue]="null" disabled>Selecciona una opción</option>
            <option [ngValue]="1">Sí</option>
            <option [ngValue]="0">No</option>
          </select>
        </div>
      </div>
    </div>

    <!-- DOLOR ACTUAL (editable) -->
    <div class="bg-app-card border border-app-border rounded-2xl p-4 sm:p-5 space-y-4">
      <h2 class="text-sm font-semibold">Dolor o molestia actual</h2>

      <div class="grid sm:grid-cols-3 gap-4 text-sm">
        <!-- Nivel de dolor -->
        <div class="space-y-1">
          <label class="text-xs text-text-muted">Nivel de dolor (1 = nada, 10 = muy intenso)</label>
          <input
            type="number"
            min="0"
            max="10"
            [(ngModel)]="conditionForm.dolor_nivel"
            name="dolor_nivel"
            placeholder="Ejemplo: 4"
            class="w-full rounded-lg border border-app-border bg-slate-900 px-3 py-2 text-sm outline-none
                   focus:border-primary focus:ring-2 focus:ring-primary/40"
          />
        </div>

        <!-- Días con dolor -->
        <div class="space-y-1">
          <label class="text-xs text-text-muted">Días con dolor</label>
          <input
            type="number"
            min="0"
            max="60"
            [(ngModel)]="conditionForm.dolor_dias"
            name="dolor_dias"
            placeholder="Ejemplo: 3"
            class="w-full rounded-lg border border-app-border bg-slate-900 px-3 py-2 text-sm outline-none
                   focus:border-primary focus:ring-2 focus:ring-primary/40"
          />
        </div>

        <!-- Zona con dolor -->
        <div class="space-y-1">
          <label class="text-xs text-text-muted">Zona principal con dolor</label>
          <input
            type="text"
            [(ngModel)]="conditionForm.dolor_zona"
            name="dolor_zona"
            placeholder="Ejemplo: tobillo derecho, rodilla izquierda…"
            class="w-full rounded-lg border border-app-border bg-slate-900 px-3 py-2 text-sm outline-none
                   focus:border-primary focus:ring-2 focus:ring-primary/40"
          />
        </div>
      </div>
    </div>

    <!-- Mensajes -->
    <div *ngIf="submitMessage" class="text-xs bg-accent/10 border border-accent/40 text-accent rounded-lg px-3 py-2 mb-3">
      {{ submitMessage }}
    </div>

    <div *ngIf="error" class="text-xs bg-danger/10 border border-danger/40 text-danger rounded-lg px-3 py-2 mb-3">
      {{ error }}
    </div>

    <!-- Card con la recomendación -->
    <div *ngIf="recomendacion" class="bg-app-card border border-app-border rounded-2xl p-4 sm:p-5 space-y-3 mt-2">
      <h2 class="text-sm font-semibold">Resultado de la recomendación</h2>

      <p class="text-xs text-text-muted">
        Fecha: {{ recomendacion.fecha }} · Gravedad:
        <span class="font-semibold">{{ recomendacion.gravedad }}</span>
      </p>

      <p class="text-sm font-medium">
        Tipo de lesión estimada:
        <span class="font-semibold">{{ recomendacion.tipo_lesion }}</span>
      </p>

      <p class="text-sm text-text-muted">
        {{ recomendacion.descripcion }}
      </p>

      <div class="text-xs mt-2">
        <p class="font-semibold mb-1">Recomendaciones:</p>
        <ul class="list-disc list-inside space-y-1">
          <li *ngFor="let rec of recomendacion.recomendaciones">
            {{ rec }}
          </li>
        </ul>
      </div>

      <div class="text-xs mt-3">
        <p class="font-semibold mb-1">¿Debes acudir con especialista?</p>
        <p>
          <span *ngIf="recomendacion.especialista?.necesario; else noEspecialista">
            ✅ Sí. {{ recomendacion.especialista?.motivo }}
          </span>
          <ng-template #noEspecialista>
            ℹ️ No estrictamente, pero {{ recomendacion.especialista?.motivo }}
          </ng-template>
        </p>
      </div>
    </div>

    <!-- Botón -->
    <div class="flex justify-end mt-4">
      <button
        type="submit"
        [disabled]="cargando"
        class="inline-flex items-center justify-center rounded-xl bg-primary px-6 py-2.5 text-sm font-semibold text-white shadow-lg shadow-primary/30 hover:bg-primary-dark transition disabled:opacity-60 disabled:cursor-not-allowed"
      >
        {{ cargando ? 'Generando...' : 'Generar recomendación de hoy' }}
      </button>
    </div>
  </form>
</div>
